<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.13.7"><meta name="robots" content="noindex, nofollow"><title>basic-fft-mic</title><script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/p5.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/addons/p5.sound.min.js"></script><script src="/tina/lib.js"></script><link rel="stylesheet" href="/tina/_astro/_scene_.DPGnVY27.css">
<link rel="stylesheet" href="/tina/_astro/index.DvM8fNzr.css">
<style>html{overflow:hidden}canvas{margin:auto}
</style></head> <body> <img class="absolute w-0 h-0" src="https://librecounter.org/counter.svg" loading="eager" decoding="async" referrerpolicy="unsafe-url" id="libre-counter"> <script>let tina, fft, mic, spectrum

function setup() {
  createCanvas(windowWidth, windowHeight)

  tina = new Tina(width, height)

  const bands = 512

  fft = new p5.FFT(0, bands)
  mic = new p5.AudioIn()
  mic.start()
  fft.setInput(mic)

  spectrum = fft.analyze()

  setInterval(() => {
    spectrum = fft.analyze()
    for (let i = 0; i < spectrum.length; i++) {
      let spec = spectrum[i] || 0
      spec = map(spec, 0, 255, 0, 1)
      spectrum[i] = spec
    }
  }, 1000 / 30)

  tina.build(/* glsl */ `
    uniform sampler2D graphics;
    uniform float spectrum[${bands}];

    ---

    vec2 coord = uv * vec2(width, height);
    coord.x += 1.;

    vec4 prev = texture(
      graphics,
      coord / vec2(width, height)
    );

    bool isCurrent = coord.x > width - 1.;

    if(isCurrent) {
      float freq = 1. - uv.y;
      float spec = spectrum[int(freq * ${bands}.)];
      float amp = pow(sin(spec * PI / 2.), 2.);
      fragColor = vec4(
        hsv2rgb(freq, 1. - amp, amp), 1.
      );
    } else {
      fragColor = vec4(prev.rgb, 1.);
    }
  `)
}

let graphics
function draw() {
  const uniforms = { spectrum }
  if (graphics) uniforms.graphics = graphics
  graphics = tina.update(uniforms)
  image(graphics, 0, 0, width, height)
}
</script> </body> </html> 